# Redis持久化

*参考：[Redis 的持久化有哪几种方式？](https://doocs.gitee.io/advanced-java/#/./docs/high-concurrency/redis-persistence)*

*参考：[Redis Persistence](https://redis.io/topics/persistence)*

Redis的是个内存数据库，它的高效率操作都是基于内存的。这样的话，如果服务器宕机重启，数据不就丢了吗？Redis基于此提供了 持久化机制，在内存操作的同时，将内存中的数据**异步**写入磁盘。在Redis重启时，将数据从持久化文件里恢复到内存中。

Redis提供了几种持久化方案的选项：

- **RDB**(Redis Database)：以指定的时间间隔，周期性地保存内存“快照”。
- **AOF**(Append Only File)：以日志的方式记录每一条写操作。需要恢复时，将这些写操作依次跑一编来重构内存数据集。
- **RDB + AOF**：Redis支持在一个实例中同时使用RDB与AOF。但是需要注意的是，在恢复时，会选择AOF文件，因为AOF方式保存的数据相对更完整。
- 无持久化：你也可以选择关闭持久化。

RDB与AOF两种持久化方案各有千秋，使用时需要根据二者的优劣势结合实际需求选择使用。

## 1 RDB

### 1.1 优势

- 作为内存快照来说，对比AOF方式记录的文件，RDB文件通常比较“袖珍”，所以它非常适合用来做备份。比如你可以保留24小时的每小时快照，或是保留一个月的每日快照，真要遇到某些“操蛋”的场景，你可以选择不同版本的快照来快速恢复数据集。
- 对Redis性能影响较小，主进程不需要进行磁盘IO，是需要fork出一个子进程来进行磁盘IO操作。
- 对于大数据集来说，RDB的恢复速度要比AOF要快。
- 在主从复制机制中，RDB保证了重启和故障转移时的*部分复制*

### 1.2 劣势

