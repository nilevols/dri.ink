# JVM垃圾回收机制

## 概述

了解完jvm内存区域的知识，必然会引申到jvm的垃圾回收机制。**垃圾回收(Garbage Collection, GC)**，简单来讲就是清理掉jvm内存中的垃圾对象，以释放空间，更有效地利用内存。

## 如何判断垃圾

### 引用计数法

 Java中，使用一个对象必须通过引用来进行。那么是不是可以这样认为：*当一个对象没有有效的引用指向它时，这个对象差不多可以被干掉了。*那么我们给每一个对象加一个`引用计数器`，每有一处引用指向它时，计数器+1，当引用失效时，计数器-1。需要的时候，检查对象的计数器，当计数器归0时，认定当前对象为可回收。

但是，引用计数法无法解决对象的**循环引用**问题。

![image-20210627130252475](assets/image-20210627130252475.png)

### 可达性分析

为了解决上面的问题，Java采用了***可达性分析***算法。其思想是，通过一系列`GC Roots`对象作为起点进行搜索，如果在`GC Roots`对象和一个对象之间没有可达路径，则认为该对象是不可达的。但是不可达对象并不等价于可回收对象，判定为不可达对象要变为可回收对象，至少需要经过两次标记过程。两次标记后仍是不可达对象的，将面临回收。

![image-20210627130330958](assets/image-20210627130330958.png)

可作为GC Roots的对象包括但不限于如下几种：

1. 虚拟机栈(栈帧中的本地变量表)中引用的对象
2. 方法区中静态属性引用的对象
3. 方法区中常量引用的对象
4. 本地方法栈中引用的对象

## 垃圾回收算法

### 标记清除法

标记清除法是将垃圾清除分为两个阶段：

1. 标记：从根节点开始标记出需要回收的对象
2. 清除：清理需要回收的对象，回收空间

